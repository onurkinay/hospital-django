{% extends 'management_base.html' %}

{% load static %}
{% block title %}
  Admins
{% endblock %}
{% block content %}
  <section id="doktor-yonetimi">
    <div class="container">
      <h2 style="display:inline">Admin Management</h2>
      {% for group in request.user.groups.all %}
        {% if group.name == 'Admin' %}
          <div class="addButton">
            <a class="addButtonInside" href="/Admins/Create">Add Admin</a>
          </div>
        {% endif %}
      {% endfor %}
      <div class="bosluk"></div>
      {% if dataset.count == 0 %}
        <p>No record</p>
      {% else %}
        <ul class="responsive-table">
          <li class="table-header">
            <div class="col col-1">User ID</div>
            <div class="col col-2">Email</div>
            <div class="col col-4">Actions</div>
          </li>
          {% for data in dataset %}
            <li class="table-row">
              <div class="col col-1" data-label="User ID">{{ data.User.first_name }} {{ data.User.last_name }}</div>
              <div class="col col-2" data-label="Admin Name">{{ data.User.email }}</div>
              <div class="col col-4" data-label="Operation">
                <a href="/Admins/Edit/{{ data.ID }}">Edit</a> |
                <a class="getDetails" href="/Admins/Details/{{ data.ID }}/">Details</a>
                |{% if data.ID != 1 %}
                  <a class="delete" href="/Admins/Delete/{{ data.ID }}/">Delete</a>
                {% else %}
                  Can't be deleted
                {% endif %}
              </div>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  </section>

  <div id="ex1" class="modal" style="max-width:initial">
    <section id="ozel-sayfa" style="padding:0;margin-bottom:0">
      <div class="container" style="max-width:initial">
        <div class="kisisel-bilgiler">
          <h3>Personal Information</h3>
          <ul>
            <li class="adminUserId">
              <span>User Id:</span>
            </li>
            <li class="adminDoB">
              <span>Date of Birth:</span>
            </li>
            <li class="adminNumber">
              <span>Phone Number:</span>
            </li>
          </ul>
        </div>
        <div class="hesap-bilgileri">
          <h3>-</h3>
          <ul>
            <li class="adminGender">
              <span>Experience:</span>
            </li>
            <li class="adminEmail">
              <span>E-Mail Address:</span>
            </li>
          </ul>
        </div>
      </div>
    </section>
  </div>

  <script>
    $('.delete').click(function (event) {
      //linke click eventi kazand覺rma
      event.preventDefault()
      if (confirm('Do you sure delete this admin')) {
        $.ajax({
          url: this.href,
          data: {
            csrfmiddlewaretoken: '{{ csrf_token }}'
          },
          type: 'POST',
          success: function (result) {
            location.reload()
          }
        })
      }
    })
    //hasta taraf覺
    $('.getDetails').click(function (event) {
      //linke click eventi kazand覺rma
      event.preventDefault()
      this.blur()
      $.get(this.href, function (json) {
        const admin = json
        $('li.adminUserId').html('<span>Name Surname:</span> ' + admin[1].first_name + ' ' + admin[1].last_name)
        $('li.adminDoB').html('<span>Date of Birth:</span> ' + new Date(admin[0].DateOfBirth).toLocaleDateString())
        $('li.adminNumber').html('<span>Phone Number:</span> ' + admin[0].Phone)
        $('li.adminEmail').html('<span>Email:</span> ' + admin[1].email)
        $('li.adminGender').html('<span>Gender:</span> ' + admin[0].Gender)
        $('#ex1').modal()
      })
    })
    
    //hasta taraf覺
  </script>
{% endblock %}
